# wkhtmltopdf の置き換え
{: .counting }

この節では、wkhtmltopdf を置き換えることを狙っていろいろ検討したもの紹介します。
最終的にはどの選択肢でも満足する結果を得ることはできなかったのですが、個別の理由もそえつつ解説していきます。


## Prince（PrinceXML）
{: .counting }

[https://www.princexml.com/]()

XHTML + CSS から PDF を出力するためのソフトウェア。
コマンドラインから利用することが可能で、

商用のソフトで、個人使用向けの Desktop License で 495 USD, 学割で 198 USD、サーバライセンスとなると 3800 USD / server などのお値段となっています。
評価版は無償で利用が可能ですが、その場合出力される PDF に Prince のアイコンが挿入されます。
商用のソフトウェアを Webook のバックエンドとするのは難しいと思われたため、採用しませんでした。


## DocRaptor
{: .counting }

[https://docraptor.com/]()

Web API として提供されるタイプの PDF 出力ソリューション。
ドキュメントをちらりと見た感じだと、バックエンドに Prince を利用している感じでしょうか。
curl などで Web API として直接叩いたり、Ruby や Python などといった各種言語に向けて、その言語の中から直接扱うためのライブラリが提供されておりここは使い勝手が良さそうです。

有償のサービスだが、7日間限定の評価ライセンスがあります。
評価ライセンスの制限を超えて利用する場合はライセンス料を支払う必要があり、最も安い Basic というプランでは 125 ドキュメント / 月 までの出力が可能で 15 USD / 月というものから始まります。
この程度ならそれほど高くはないと感じられるが、ドキュメントを生成しながらトライアンドエラーで執筆していきたい場合にはこの回数制限がネックになるかもしれません。


## Google Chrome（ヘッドレスモード）
{: .counting }

[https://www.google.com/intl/ja_ALL/chrome/]()

Google Chrome はヘッドレス（GUI などを伴わない状態）モードで起動することを可能にする起動オプションがあります（`--headless`）。
さらに、指定したドキュメントを直接 PDF に出力できるオプションがあります（`--print-to-pdf`）。

結構期待してはいたのですが、結局のところ、次の点がネックとなり採用することができませんでした。
天下の Google Chrome サマをもってしても、印刷向けの CSS の対応は十分ではないようです。

- 出力結果に意図しないファイル名とページ番号が最終ページのフッタ部分に挿入されてしまい、これを回避する方法がなかった。
HTML ファイルを直接開きいて、印刷メニューから PDF を出力するという操作を手動で行った場合フッタ部分を隠すことが可能だった
- 結局 CSS 組版に必要な CSS をサポートしていない


## Vivliostyle.js
{: .counting }

[https://vivliostyle.org/]()

CSS 組版に必要な CSS などを解釈し実行する JavaScript ライブラリ。
適当な HTML に Vivliostyle を適用することで、組版された本のような表示を行うことができます。
コアモジュール Vivliostyle.js と、それを用いた標準的なビューワ実装などが存在するようです。

サンプルをいろいろと見て一見問題なさそう（むしろとても良く表示されている）に見えましたが、
そのまま印刷（PDF に出力）してみた結果、うまいこと表示されないものも多かったです（テキストが消えてしまう、不自然な余白が見えてしまうなど）。
あくまでブラウザ上で表示することを主軸にした作りになっているのでしょうか？

技術書同人誌界隈にも CSS 組版をうたった同人誌は散見されますが、結局のところ Vivliostyle.js を通してプレビューから印刷しているところは共通してるようです。
先に述べたとおり、Webook のスタイルは `webook build` コマンドで最終的な PDF を得るところまで完結することを目指しているので、方向性が若干合わないため採用できませんでした。



## Viola (viola-savepdf)
{: .counting }

[https://writing.viola.pub/]()

エディタ + プレビュー + PDF 出力などのを備えた Web アプリケーション。
Web ブラウザでアクセスするだけで利用することが可能であり、とても気軽に始めることができます。

同作者の viola-savepdf は npm で提供さているもので、Vivliostyle を適用した PDF ファイルを出力することが可能な savepdf コマンドを提供してくれます。
こちらもけっこう期待していたのですが、サイズ指定オプションが機能しない、フォントが表示されないなどの結果となり、採用を見送ってしまいました。

Chrome の Canary ビルドを要すると書いているので、もしかしたら macOS や Windows 上での動作しか想定していないのかもしれません（筆者は Docker 上の Ubuntu で動作させていました）。


## まとめ
{: .counting }

とまあ、このような感じでいろいろやってみたのですが、個別に問題があったり、上手くインテグレートできそうになかったりといろいろと収まりの悪い結果になってしまいました。
時間的にも選択肢的にも策がつきた感じで、結局のところ本書も wkhtmltopdf を使って出力しています。
今回はこれらの知見をまとめ、準備号として今回は収めようということになりました。